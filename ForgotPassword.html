<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
      integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

    <link rel="stylesheet" href="style.css" />
    <title>Forgot Password</title>
  </head>
  <body>
    <h2>Forgot Password</h2>
    <form id="forgotPasswordForm">
      <div class="input-container">
        <input
          id="forgotUserName"
          type="text"
          placeholder="Enter Your Username"
          required
        />
      </div>
      
      <div class="input-container">
        <input
          id="newPassword"
          type="password"
          placeholder="New Password"
          required
        />
      </div>
      <div class="input-container">
        <input type="submit" class="btn-submit" value="Submit" />
      </div>
      <div id="error-message" style="color: red"></div>
    </form>

    <script>
      $(document).ready(function () {
        $("#forgotPasswordForm").on("submit", function (event) {
          event.preventDefault(); // Prevent form submission

          const username = $("#forgotUserName").val();
          const newPassword = $("#newPassword").val();

          // Retrieve users from the cookie
          const users = getCookie("formData");
          if (users) {
            let parsedUsers = JSON.parse(users); // Parse the stored JSON

            // Find the user by username
            const userIndex = parsedUsers.findIndex(
              (user) => user.userName === username
            );

            if (userIndex !== -1) {
              // Update the password
              parsedUsers[userIndex].password = newPassword;

              // Update the cookie with new password
              setCookie("formData", JSON.stringify(parsedUsers), 365);

              alert("Password updated successfully.");
              window.location.href = "Login.html"; // Redirect to login page
            } else {
              alert("User not found.");
            }
          } else {
            alert("No users registered.");
          }
        });

        // Function to retrieve a cookie by name
        function getCookie(name) {
          const value = `; ${document.cookie}`;
          const parts = value.split(`; ${name}=`);
          if (parts.length === 2) return parts.pop().split(";").shift();
        }

        // Function to set a cookie
        function setCookie(name, value, days) {
          const date = new Date();
          date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
          const expires = `expires=${date.toUTCString()}`;
          document.cookie = `${name}=${value}; ${expires}; path=/`;
        }
      });
    </script>
  </body>
</html>
